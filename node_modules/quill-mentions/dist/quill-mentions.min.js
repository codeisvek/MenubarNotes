!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){function d(a,b,c){this.format=a,this.view=b,this.database=this.munge(c.data),this.max=c.max}function e(a,b,c){this.format=a,this.view=b,this.max=c.max}function d(a,b,c){e.call(this,a,b,c),this.database=this.munge(c.data)}function f(a,b,c){e.call(this,a,b,c),this.path=c.path,this.queryParameter=c.queryParameter,this._latestCall=null}function g(a){console.log("Loading json errored! Likely due to aborted request, but there's the error: ",a)}var h=a("./utilities/ajax").loadJSON,i=a("./utilities/regexp").escapeRegExp;b.exports={Controller:d,AJAXController:f},e.prototype.search=function(){throw new Error("NYI")},e.prototype.munge=function(a){return a.map(this.format)},d.prototype=Object.create(e.prototype),d.prototype.search=function(a,b){var c,d=new RegExp(i(a),"i");c=this.database.filter(function(a){return d.test(a.value)}).sort(function(b,c){return b.value.indexOf(a)-c.value.indexOf(a)}),this.view.render(c.slice(0,this.max)),b&&b()},f.prototype=Object.create(e.prototype),f.prototype.search=function(a,b){function c(a){this._callback(a),b&&b()}this._latestCall&&this._latestCall.abort();var d=this.path+"?"+this.queryParameter+"="+encodeURIComponent(a);this._latestCall=h(d,c.bind(this),g)},f.prototype._callback=function(a){a=this.munge(a).slice(0,this.max),this.view.render(a)}},{"./utilities/ajax":6,"./utilities/regexp":10}],2:[function(a,b,c){function d(a){var b=e({},g,a);return a.ajax&&(b.ajax=e({},h,a.ajax)),b}var e=a("../utilities/extend"),f=a("../utilities/identity"),g={ajax:!1,choiceMax:6,choices:[],choiceTemplate:'<li data-display="{{value}}" data-mention="{{data}}">{{value}}</li>',containerClassName:"ql-mentions",format:f,hotkeys:!0,includeTrigger:!1,marginTop:10,matcher:/@\w+$/i,mentionClass:"mention-item",noMatchMessage:"Ruh Roh Raggy!",noMatchTemplate:"<div class='ql-mention-no-match'><i>{{message}}</i></div>",template:"<ul>{{choices}}</ul>",triggerSymbol:"@"},h={format:f,path:null,queryParameter:"q"};b.exports=d},{"../utilities/extend":8,"../utilities/identity":9}],3:[function(a,b,c){(function(b){b.QuillMentions=a("./mentions")}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./mentions":5}],4:[function(a,b,c){function d(){this.view.isHidden()||h.call(this,1)}function e(){this.view.isHidden()||h.call(this,-1)}function f(){var a,b,c=this.selectedChoiceIndex;-1!==c&&this.view.hasMatches()&&(this.quill.setSelection(this._cachedRange),a=this.view.getMatches(),b=a[c],this.addMention(b),this.selectedChoiceIndex=-1)}function g(){this.view.hide(),this.selectedChoiceIndex=-1,this.quill.focus()}function h(a){var b,c,d,e,f=this.selectedChoiceIndex;return b=this.view.container.querySelectorAll("li"),0===b.length?void(this.selectedChoiceIndex=-1):(-1!==f&&(c=b[f],l(c,m)),d=i(f+a,b.length),e=b[d],void(e?(k(e,m),this.selectedChoiceIndex=d):console.log("Indexing error on node returned by querySelectorAll")))}function i(a,b){if(0>=b)throw new Error("TF are you doing? _normalizeIndex needs a nonnegative, nonzero modulo.");for(;0>a;)a+=b;return a%b}var j=a("./utilities/dom"),k=j.addClass,l=j.removeClass,m="ql-mention-choice-selected",n={27:g,38:e,40:d},o={13:f};b.exports={keyup:o,keydown:n}},{"./utilities/dom":7}],5:[function(a,b,c){function d(a,b){this.quill=a;var c=i(b),d=this.quill.addContainer(c.containerClassName);this.triggerSymbol=c.triggerSymbol,this.includeTrigger=c.includeTrigger,this.matcher=c.matcher,this.mentionClass=c.mentionClass,this.currentMention=null,this.selectedChoiceIndex=-1,this.setView(d,c).setController(c).listenTextChange(a).listenSelectionChange(a).listenClick(d).addFormat(),c.hotkeys&&this.listenHotKeys(a),this._cachedRange=null,this.charSinceMention=0}var e=a("./controller").AJAXController,f=a("./controller").Controller,g=a("./view"),h=a("./utilities/extend"),i=a("./defaults/defaults"),j=a("./keyboard").keyup,k=a("./keyboard").keydown;b.exports=d,d.prototype.setView=function(a,b){var c={},d=b.noMatchMessage,e=b.marginTop;return c.list=b.template,c.listItem=b.choiceTemplate,c.error=b.noMatchTemplate,this.view=new g(a,c,{errMessage:d,marginTop:e}),this},d.prototype.setController=function(a){if(!this.view)throw new Error("Must set view before controller.");var b,c={max:a.choiceMax};return a.ajax?(b=a.ajax.format,h(c,a.ajax),this.controller=new e(b,this.view,c)):(b=a.format,c.data=a.choices,this.controller=new f(b,this.view,c)),this},d.prototype.listenTextChange=function(a){function b(b,c){if("api"!==c){var d,e,f=this.findMention();f?(e=this,this.charSinceMention=0,this._cachedRange=a.getSelection(),this.currentMention=f,this._addTemporaryMentionSpan(),d=f[0].replace(this.triggerSymbol,""),this.controller.search(d,function(){e.view.show(e.quill)})):(this.charSinceMention++,this.view.hide())}}var c=this.quill.constructor.events.TEXT_CHANGE;return a.on(c,b.bind(this)),this},d.prototype.listenSelectionChange=function(a){function b(a){a||this.view.hide()}var c=a.constructor.events.SELECTION_CHANGE;return a.on(c,b.bind(this)),this},d.prototype.listenHotKeys=function(a){function b(a){var b=a.keyCode||a.which;this.view.isHidden()||k[b]&&(k[b].call(this),a.stopPropagation(),a.preventDefault())}function c(a){var b=a.keyCode||a.which;this.view.isHidden()&&1!==this.charSinceMention||j[b]&&j[b].call(this)}return a.container.addEventListener("keydown",b.bind(this)),a.container.addEventListener("keyup",c.bind(this)),this},d.prototype.listenClick=function(a){function b(a){var b=a.target||a.srcElement;"li"===b.tagName.toLowerCase()&&this.addMention(b),a.stopPropagation()}return a.addEventListener("click",b.bind(this)),a.addEventListener("touchend",b.bind(this)),this},d.prototype.findMention=function(){var a=this.quill.getSelection()||this._cachedRange,b=a.end,c=this.quill.getText(0,b);return this.matcher.exec(c)},d.prototype.addMention=function(a){var b=this.currentMention.index,c=(this.includeTrigger?this.triggerSymbol:"")+a.dataset.display,d=b+c.length+1;this.quill.deleteText(b,b+this.currentMention[0].length),this.quill.insertText(b,c,"mention",this.mentionClass+"-"+a.dataset.mention),this.quill.insertText(b+c.length," "),this.quill.setSelection(d,d),this.view.hide()},d.prototype._addTemporaryMentionSpan=function(a){var b=this.currentMention.index,c=this.currentMention[0];this.quill.deleteText(b,b+this.currentMention[0].length),this.quill.insertText(b,c,"mention","is-typing-mention")},d.prototype.hasSelection=function(){return-1!==this.selectedChoiceIndex},d.prototype.addFormat=function(a){return this.quill.addFormat("mention",{tag:"SPAN","class":"ql-"}),this}},{"./controller":1,"./defaults/defaults":2,"./keyboard":4,"./utilities/extend":8,"./view":12}],6:[function(a,b,c){b.exports={loadJSON:function(a,b,c){var d=new XMLHttpRequest;return d.onreadystatechange=function(){d.readyState===XMLHttpRequest.DONE&&(200===d.status?b&&b(JSON.parse(d.responseText)):c&&c(d))},d.open("GET",a,!0),d.send(),d}}},{}],7:[function(a,b,c){function d(a,b){f(a,b)||(a.className+=" "+b)}function e(a){var b=[a];if(!a)return[];for(;a.previousSibling;)b.push(a.previousSibling),a=a.previousSibling;return b}function f(a,b){return a?-1!==a.className.indexOf(b):console.log("Called hasClass on an empty node")}function g(a,b){if(f(a,b))for(;f(a,b);)a.className=a.className.replace(b,"")}b.exports.addClass=d,b.exports.getOlderSiblingsInclusive=e,b.exports.hasClass=f,b.exports.removeClass=g},{}],8:[function(a,b,c){function d(a){for(var b=[].slice.call(arguments,0),c=b[0],d=1;d<b.length;d++)c=e(c,b[d]);return c}function e(a,b){for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}b.exports=d},{}],9:[function(a,b,c){function d(a){return a}b.exports=d},{}],10:[function(a,b,c){b.exports={escapeRegExp:function(a){return a.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}}},{}],11:[function(a,b,c){function d(a,b,c,d){d=d||"";var f="g"+d,g=new RegExp(e(b),f);return a.replace(g,c)}var e=a("./regexp").escapeRegExp;b.exports={all:d}},{"./regexp":10}],12:[function(a,b,c){function d(a,b,c){this.container=a,this.templates=f({},b),this.marginTop=c.marginTop,this.errMessage=c.errMessage}var e=a("./utilities/dom"),f=a("./utilities/extend"),g=a("./utilities/string-replace").all;a("./utilities/regexp").escapeRegExp;b.exports=d,d.prototype.render=function(a){var b,c,d=this.templates;return a&&a.length?(b=a.map(this._renderLI,this).join(""),this.container.innerHTML=d.list.replace("{{choices}}",b)):(c=d.error.replace("{{message}}",this.errMessage),this.container.innerHTML=c),this},d.prototype._renderLI=function(a){var b=this.templates.listItem;return this._renderWithContext(b,a)},d.prototype._renderWithContext=function(a,b){var c,d=a;for(c in b)b.hasOwnProperty(c)&&(d=g(d,"{{"+c+"}}",b[c]));return d},d.prototype.hide=function(a,b){return e.removeClass(this.container,"ql-is-mentioning"),this.container.style.marginTop="0",b&&a.setSelection(b),this},d.prototype.getMatches=function(){return this.container.querySelectorAll("li")},d.prototype.hasMatches=function(){return this.getMatches().length>0},d.prototype.isHidden=function(){return!e.hasClass(this.container,"ql-is-mentioning")},d.prototype.show=function(a){return this.container.style.marginTop=this._getTopMargin(a),this.container.style.marginLeft=this._getLeftMargin(a),e.addClass(this.container,"ql-is-mentioning"),this.container.focus(),this},d.prototype._findOffsetLines=function(a){var b=this._findMentionContainerNode(a);return e.getOlderSiblingsInclusive(b)},d.prototype._findMentionContainerNode=function(a){var b,c,d,e,f=a.getSelection();for(b=a.editor.doc.findLeafAt(f.start,!0),c=b[0],d=b[1],c&&(e=c.node);e&&"DIV"!==e.tagName;)e=e.parentNode;return e?e:null},d.prototype._findMentionNode=function(a){var b,c,d,e,f=a.getSelection();for(b=a.editor.doc.findLeafAt(f.start,!0),c=b[0],d=b[1],c&&(e=c.node);e&&"SPAN"!==e.tagName;)e=e.parentNode;return e?e:null},d.prototype._getLeftMargin=function(a){var b=this._findMentionNode(a),c=this._findMentionContainerNode(a),d=b.getBoundingClientRect(),e=c.getBoundingClientRect(),f=a.container.getBoundingClientRect(),g=d.left-e.left,h=g+d.width-f.width;return h>0&&(g-=h),g+"px"},d.prototype._getTopMargin=function(a){var b,c=a.editor.root,d=this.marginTop,e=-d;return b=this._findOffsetLines(a),e+=this._nodeHeight(c),e-=b.reduce(function(a,b){return a+this._nodeHeight(b)}.bind(this),0),"-"+e+"px"},d.prototype._nodeHeight=function(a){return a.getBoundingClientRect().height}},{"./utilities/dom":7,"./utilities/extend":8,"./utilities/regexp":10,"./utilities/string-replace":11}]},{},[1,2,3,4,5,6,7,8,9,10,11,12]);